<div class="user-profile">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <img [src]="userProfile?.profilePictureUrl || defaultAvatar" [alt]="userProfile?.fullName" class="avatar">
      <button mat-mini-fab color="primary" class="edit-avatar-btn">
        <mat-icon>camera_alt</mat-icon>
      </button>
    </div>
    <div class="profile-info">
      <h1>{{userProfile?.fullName}}</h1>
      <p>{{userProfile?.email}}</p>
      <div class="profile-stats">
        <div class="stat">
          <div class="stat-value">{{userProfile?.loyaltyPoints || 0}}</div>
          <div class="stat-label">Loyalty Points</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{addresses.length}}</div>
          <div class="stat-label">Saved Addresses</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{paymentMethods.length}}</div>
          <div class="stat-label">Payment Methods</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Content -->
  <mat-tab-group class="profile-tabs">
    <!-- Personal Information Tab -->
    <mat-tab label="Personal Info">
      <form [formGroup]="personalInfoForm" (ngSubmit)="savePersonalInfo()">
        <mat-card class="profile-section">
          <mat-card-header>
            <mat-card-title>Personal Information</mat-card-title>
            <mat-card-subtitle>Update your basic profile details</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Full Name</mat-label>
                <input matInput formControlName="fullName" placeholder="Enter your full name">
                <mat-error *ngIf="personalInfoForm.get('fullName')?.invalid">Full name is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" type="email" placeholder="Enter your email">
                <mat-icon matSuffix>email</mat-icon>
                <mat-error *ngIf="personalInfoForm.get('email')?.invalid">Valid email is required</mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Phone Number</mat-label>
                <input matInput formControlName="phone" placeholder="Enter your phone number">
                <mat-icon matSuffix>phone</mat-icon>
                <mat-error *ngIf="personalInfoForm.get('phone')?.invalid">Valid phone number is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Date of Birth</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="dateOfBirth">
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Address</mat-label>
                <textarea matInput formControlName="address" rows="3" placeholder="Enter your full address"></textarea>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>City</mat-label>
                <input matInput formControlName="city" placeholder="Enter your city">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>State</mat-label>
                <input matInput formControlName="state" placeholder="Enter your state">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Postal Code</mat-label>
                <input matInput formControlName="postalCode" placeholder="Enter postal code">
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline">
              <mat-label>Gender</mat-label>
              <mat-select formControlName="gender">
                <mat-option value="M">Male</mat-option>
                <mat-option value="F">Female</mat-option>
                <mat-option value="OTHER">Other</mat-option>
                <mat-option value="PREFER_NOT_TO_SAY">Prefer not to say</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button type="button" (click)="resetPersonalInfo()">Reset</button>
            <button mat-flat-button color="primary" type="submit" [disabled]="personalInfoForm.invalid">
              Save Changes
            </button>
          </mat-card-actions>
        </mat-card>
      </form>
    </mat-tab>

    <!-- Preferences Tab -->
    <mat-tab label="Preferences">
      <form [formGroup]="preferencesForm" (ngSubmit)="savePreferences()">
        <mat-card class="profile-section">
          <mat-card-header>
            <mat-card-title>Food Preferences</mat-card-title>
            <mat-card-subtitle>Tell us about your food preferences to get better recommendations</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="preferences-section">
              <h3>Cuisine Preferences</h3>
              <mat-chip-listbox formControlName="cuisines" multiple>
                <mat-chip-option value="ITALIAN">Italian</mat-chip-option>
                <mat-chip-option value="CHINESE">Chinese</mat-chip-option>
                <mat-chip-option value="INDIAN">Indian</mat-chip-option>
                <mat-chip-option value="MEXICAN">Mexican</mat-chip-option>
                <mat-chip-option value="JAPANESE">Japanese</mat-chip-option>
                <mat-chip-option value="AMERICAN">American</mat-chip-option>
                <mat-chip-option value="THAI">Thai</mat-chip-option>
                <mat-chip-option value="MEDITERRANEAN">Mediterranean</mat-chip-option>
              </mat-chip-listbox>
            </div>

            <div class="preferences-section">
              <h3>Dietary Restrictions</h3>
              <mat-chip-listbox formControlName="dietary" multiple>
                <mat-chip-option value="VEGETARIAN">Vegetarian</mat-chip-option>
                <mat-chip-option value="VEGAN">Vegan</mat-chip-option>
                <mat-chip-option value="GLUTEN_FREE">Gluten Free</mat-chip-option>
                <mat-chip-option value="DAIRY_FREE">Dairy Free</mat-chip-option>
                <mat-chip-option value="NUT_FREE">Nut Free</mat-chip-option>
                <mat-chip-option value="HALAL">Halal</mat-chip-option>
                <mat-chip-option value="KOSHER">Kosher</mat-chip-option>
              </mat-chip-listbox>
            </div>

            <div class="preferences-section">
              <h3>Budget Range</h3>
              <mat-chip-listbox formControlName="budget">
                <mat-chip-option value="LOW">$ - Budget Friendly</mat-chip-option>
                <mat-chip-option value="MEDIUM">$$ - Moderate</mat-chip-option>
                <mat-chip-option value="HIGH">$$$ - Premium</mat-chip-option>
                <mat-chip-option value="LUXURY">$$$$ - Fine Dining</mat-chip-option>
              </mat-chip-listbox>
            </div>

            <div class="preferences-section">
              <h3>Delivery Time Preference</h3>
              <mat-chip-listbox formControlName="deliveryTime">
                <mat-chip-option value="FAST">As Fast As Possible</mat-chip-option>
                <mat-chip-option value="SCHEDULED">Scheduled Delivery</mat-chip-option>
                <mat-chip-option value="STANDARD">Standard (30-45 min)</mat-chip-option>
              </mat-chip-listbox>
            </div>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button type="button" (click)="resetPreferences()">Reset</button>
            <button mat-flat-button color="primary" type="submit">
              Save Preferences
            </button>
          </mat-card-actions>
        </mat-card>
      </form>
    </mat-tab>

    <!-- Addresses Tab -->
    <mat-tab label="Addresses">
      <div class="addresses-section">
        <div class="section-header">
          <h2>Delivery Addresses</h2>
          <button mat-flat-button color="primary" (click)="addAddress()">
            <mat-icon>add</mat-icon>
            Add Address
          </button>
        </div>

        <div class="addresses-grid">
          <mat-card class="address-card" *ngFor="let address of addresses; let i = index">
            <mat-card-header>
              <mat-card-title>{{address.addressType}}</mat-card-title>
              <div class="address-actions">
                <button mat-icon-button [color]="address.isDefault ? 'primary' : ''" (click)="setDefaultAddress(i)">
                  <mat-icon>star</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deleteAddress(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-card-header>
            <mat-card-content>
              <p>{{address.fullAddress}}</p>
              <p>{{address.city}}, {{address.state}} {{address.postalCode}}</p>
              <div class="address-tags" *ngIf="address.isDefault">
                <mat-chip color="primary" selected>Default</mat-chip>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Payment Methods Tab -->
    <mat-tab label="Payment">
      <div class="payment-section">
        <div class="section-header">
          <h2>Payment Methods</h2>
          <button mat-flat-button color="primary" (click)="addPaymentMethod()">
            <mat-icon>add</mat-icon>
            Add Payment
          </button>
        </div>

        <div class="payment-methods-grid">
          <mat-card class="payment-card" *ngFor="let method of paymentMethods; let i = index">
            <mat-card-header>
              <div class="payment-icon">
                <mat-icon>{{getPaymentIcon(method.paymentType)}}</mat-icon>
              </div>
              <mat-card-title>{{method.providerName}}</mat-card-title>
              <div class="payment-actions">
                <button mat-icon-button [color]="method.isDefault ? 'primary' : ''" (click)="setDefaultPayment(i)">
                  <mat-icon>star</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deletePaymentMethod(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-card-header>
            <mat-card-content>
              <div class="payment-details">
                <span *ngIf="method.lastFourDigits">**** {{method.lastFourDigits}}</span>
                <span *ngIf="method.upiId">{{method.upiId}}</span>
                <span *ngIf="method.walletBalance">Balance: ${{method.walletBalance}}</span>
              </div>
              <div class="payment-tags" *ngIf="method.isDefault">
                <mat-chip color="primary" selected>Default</mat-chip>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Security Tab -->
    <mat-tab label="Security">
      <div class="security-section">
        <mat-card class="security-card">
          <mat-card-header>
            <mat-card-title>Change Password</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
              <mat-form-field appearance="outline">
                <mat-label>Current Password</mat-label>
                <input matInput formControlName="currentPassword" type="password">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>New Password</mat-label>
                <input matInput formControlName="newPassword" type="password">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Confirm New Password</mat-label>
                <input matInput formControlName="confirmPassword" type="password">
              </mat-form-field>

              <mat-card-actions align="end">
                <button mat-flat-button color="primary" type="submit">
                  Update Password
                </button>
              </mat-card-actions>
            </form>
          </mat-card-content>
        </mat-card>

        <mat-card class="security-card">
          <mat-card-header>
            <mat-card-title>Account Security</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="security-item">
              <div class="security-info">
                <div class="security-label">Email Verification</div>
                <div class="security-status" [class.verified]="userProfile?.emailVerified">
                  {{userProfile?.emailVerified ? 'Verified' : 'Not Verified'}}
                </div>
              </div>
              <button mat-button color="primary" *ngIf="!userProfile?.emailVerified">
                Verify Email
              </button>
            </div>

            <div class="security-item">
              <div class="security-info">
                <div class="security-label">Phone Verification</div>
                <div class="security-status" [class.verified]="userProfile?.phoneVerified">
                  {{userProfile?.phoneVerified ? 'Verified' : 'Not Verified'}}
                </div>
              </div>
              <button mat-button color="primary" *ngIf="!userProfile?.phoneVerified">
                Verify Phone
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
